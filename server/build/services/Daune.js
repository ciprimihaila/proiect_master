var express=require("express"),router=express.Router(),helpers=require("./../lib/helpers"),ObjectID=require("mongodb").ObjectID,globalDaunaCollection;module.exports.getRouter=function(a){var b=(a.cerere,a.users,a.dauna);return globalDaunaCollection=b,router.get("/daune",function(a,c){console.log("get dauna");var d=b.find({daunaConfirmata:!1}),e=[];d.each(function(a,b){return a?void helpers.sendErrorResponse(c,a,"/login"):null===b?void c.send(JSON.stringify({status:"ok",message:e})):(console.log(b),void e.push(b))})}),router.post("/dauna",function(a,c){console.log("post dauna"),console.log(a.body);var d,e={marca:"string",polita:"string",inmatriculare:"string",cnp:"string",model:"string",location:"string",description:"string",username:"string",urlimagine:"string"};return null!==(d=helpers.validateParams(e,a.body))?void helpers.sendErrorResponse(c,d):(a.body.daunaConfirmata=!1,void b.insertOne(a.body,function(a,b){return a?void helpers.sendErrorResponse(c,a,"/register"):void helpers.sendOkResponse(c,"Constatare dauna adaugata","/introduceredauna")}))}),router.post("/updateDauna",function(a,c){console.log("post update Dauna"),console.log(a.body);b.updateOne({_id:new ObjectID(a.body.idDauna)},{$set:{daunaConfirmata:!0,serviceId:a.body.idService}},function(a,b){return a?void helpers.sendErrorResponse(c,a):void helpers.sendOkResponse(c,"Dauna trimisa in service")})}),router},module.exports.updateDaunaWithDriveID=function(a,b,c){console.log(a+" "+b+" "+c),globalDaunaCollection.update({polita:a,username:b},{$set:{urlimagine:"https://docs.google.com/uc?id="+c}},function(a,b){return a?void console.log(a):void console.log("file id updated"+b)})};