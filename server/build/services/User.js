var express=require("express"),router=express.Router(),helpers=require("./../lib/helpers");module.exports.getRouter=function(a){var b=a.users;return router.get("/user",function(a,c){console.log("get User"),console.log(a.query);var d,e={username:"string",password:"string"};return null!==(d=helpers.validateParams(e,a.query))?void helpers.sendErrorResponse(c,d):void b.findOne({username:a.query.username,password:a.query.password},function(a,b){if(a)return void helpers.sendErrorResponse(c,a,"/login");if(console.log("Got"),console.log(b),null===b)helpers.sendErrorResponse(c,"User does not exist or Incorrect Password","/login");else{b.role||(b.role=null);var d=null;d="Broker"==b.role?"/listacereripolite":"Admin"==b.role?"/usermanagement":"/cerere",helpers.sendOkResponse(c,{role:b.role},d)}})}),router.post("/user",function(a,c){console.log("post User"),console.log(a.body);var d,e={username:"string",password:"string",firstName:"string",lastName:"string",email:"string",phone:"string"};return null!==(d=helpers.validateParams(e,a.body))?void helpers.sendErrorResponse(c,d):void b.findOne({username:a.body.username},function(d,e){return d?void helpers.sendErrorResponse(c,d,"/register"):null!==e?void c.send(JSON.stringify({status:"error",message:"User already exists",url:"/register"})):(a.body.role="User",void b.insertOne(a.body,function(a,b){return a?void c.send(JSON.stringify({status:"error",message:a,url:"/register"})):void c.send(JSON.stringify({status:"ok",message:"User succesfully created",url:"/login"}))}))})}),router.get("/useri",function(a,c){console.log("get useri"),console.log(a.query);var d=b.find({}),e=[];d.each(function(a,b){return a?void helpers.sendErrorResponse(c,a):null===b?void helpers.sendOkResponse(c,e):void e.push(b)})}),router.post("/deleteUser",function(a,c){console.log("post delteUserr"),console.log(a.body);var d,e={username:"string"};return null!==(d=helpers.validateParams(e,a.body))?void helpers.sendErrorResponse(c,d):void b.findOne({username:a.body.username},function(d,e){return d?void helpers.sendErrorResponse(c,d):null===e?void helpers.sendErrorResponse(c,"User does not exist"):void b.deleteOne({username:a.body.username},function(a,b){return a?void helpers.sendErrorResponse(c,a):void helpers.sendOkResponse(c,"User deleted")})})}),router};