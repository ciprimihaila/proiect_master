var express=require("express"),router=express.Router(),helpers=require("./../lib/helpers"),ObjectID=require("mongodb").ObjectID;module.exports.getRouter=function(a){var b=a.cerere,c=a.users;return router.post("/emitereCerere",function(a,c){console.log("post emitereCerere"),console.log(a.body);b.updateOne({_id:new ObjectID(a.body.id)},{$set:{cerereEmisa:!0}},function(a,b){return a?void helpers.sendErrorResponse(c,a):void helpers.sendOkResponse(c,"Cerere emisa")})}),router.post("/cerere",function(a,d){console.log("post cerere"),console.log(a.body);var e={marca:"array",model:"array",tipauto:"array",cnp:"int",persfizica:"string",power:"int",serie:"string",combustibil:"string",anfabric:"int",date:"string",username:"string",durata:"array",address:"string"};if(!a.body.persfizica&&!a.body.persjuritica)return void helpers.sendErrorResponse(d,"Campurile persjuritica sau persfizica nu exista");var f=null;f=a.body.persfizica?"fizica":"juritica";var g;return null!==(g=helpers.validateParams(e,a.body))?void helpers.sendErrorResponse(d,g):void c.findOne({username:a.body.username},function(e,g){return e?void helpers.sendErrorResponse(d,e,"/register"):void c.updateOne({username:a.body.username},{$set:{address:a.body.address,cnp:a.body.cnp,tipPersoana:f}},function(c,e){return c?void helpers.sendErrorResponse(d,c,"/resgister"):(a.body.cerereEmisa=!1,void b.insertOne(a.body,function(a,b){return a?void helpers.sendErrorResponse(d,a,"/resgister"):void helpers.sendOkResponse(d,"Cerere trimisa","/cerere")}))})})}),router.get("/cereri",function(a,c){console.log("get cerere");var d=b.find({cerereEmisa:!1}),e=[];d.each(function(a,b){return a?void helpers.sendErrorResponse(c,a,"/login"):null===b?void helpers.sendOkResponse(c,e):void e.push(b)})}),router};